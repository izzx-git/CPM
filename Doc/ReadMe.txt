CP/M 2.2 для Scorpion ZS + SMUC + ProfROM (+ поддержка экрана GMX).
С возможностью установки на HDD.

Подготовил izzx, на основе исходников версии "CP/M v2.2 by FK0'99, Disabler Production Labaratory'00" 
(https://vtrd.in/system/CPM_CASH.zip)

Тема на форуме:
https://zx-pk.ru/threads/35004-ustanovka-cp-m-na-hdd-dlya-scorpion-zs.html

Диски:
A-B - дискеты MOA
C - дискеты ATM
D - дискеты Profi
E - HDD SMUC

Перед запуском нужно создать раздел "CPMZS0" типа MicroDOS, размером по умолчанию 32767.
Сделать холодный сброс.
Этот раздел CP/M будет подключать к диску монитора D:  (а в CP/M он будет диском E:)
Работает через RST 8.

CPMZS64.trd - диск с системой для обычного экрана.
CPMZSGMX.trd - диск с системой для расширенного экрана GMX.

Можно запускать с дискеты, файл CPM.B. Из бейсика 128 не запустится!
С виртуального диска SMUC тоже можно, но A-D в самой системе работают только с физическими дискетами.

Запуск с HDD поддержан в новых прошивках монитора, пункт "HDD boot". 
В мониторе необходимо сделать раздел CP/M активным и выбрать с какого диска запускать (см. инструкцию).
Кроме того, с новой прошивкой меньше мигает экран при обращении к HDD.

Установка на HDD: запустить INSTALL.B
1 пункт - записать систему и загрузчик в системные "дорожки" раздела.
2 - скопировать данные без системных дорожек с раздела HDD на дискету. Только первые 600Кб!  
3 - скопировать данные раздела без системных дорожек с дискеты на HDD. Только первые 600Кб!  
На дискете с дистрибутивом ничего изменять нельзя. Иначе испортится бэкап.

Таким образом, для установки CP/M достаточно выбрать пункт 1 инсталятора. Для старых прошивок
монитора пункт довольно бесполезный, для запуска всё равно потребуется дискета. Но можно запустить с дискеты файл BOOTSEC.C, тогда вся система загрузится с HDD.
 
ГЛАВНОЕ: если выбрать пункт 3, будет развёрнут готовый раздел с небольшим набором утилит и игр.


В этой версии CP/M есть драйвер для экрана под GMX (640*200, 80*25 символов).
Используется аппаратный скроллинг вверх и окно памяти #8000. 
Драйвер переделан из версии на 64 символа.
Шрифт используется 6*8 от драйвера на 85 сиволов. 
Шрифта 8*8 в нужном формате под рукой не оказалось, было бы красивее. 

Я сделал только драйверы экрана и SMUC, остальное в BIOS старался не трогать.

Вероятно, эта версия драйвера экрана изначально не полная, 
например, не предусмотрена работа с окнами. Окно всегда на весь экран.
Нет скроллинга вниз. Версия Esc кодов, похоже, от Profi.

Тестировал на игре "Ladder" со скорпионовского диска "cp_m_16.trd".
В режиме 64 символа игра не умещается, а на 80 вполне.

Глюки: 
Иногда система не запускается, пока не сделаешь холодный сброс (со стрелкой влево).

С клавиатурой сам не до конца разобрался, 
пока определил, что работают такие комбинации в терминале:
Caps Shift+Symbol Shift = Ext = Alt на PC клаве
Ext+H, курсор влево - забой влево, аналог Backspace
Ext+L (и Enter) - CLS, очистить экран
Ext+K - курсор на позицию 0,0 без очистки экрана
Ext+I - табуляция
Ext+N, Caps Shift - включить русскую раскладку (не все буквы нашёл)

Чтобы выйти из приложения иногда помогают:
Ext+C, Ext+5, Symbol Shift+Enter

Остальное читайте в родном Help-е.


-----------------------------------------------
Сборка исходников.

Запустить
_Build_64.bat
или
_Build_GMX.bat

Используется DosBox, иначе на Win 64 не работает MA80.EXE.
Возможно, придётся подправить пути.

-----------------------------------------------
Банки памяти:
7, #DB00 - шрифт + драйвер экрана
6, #C000 - DRV (CPP + BDOC)
1, #F000 - BIOS
Запуск - 1, #F000

Выбор диска по умолчанию в исходных кодах:
файл BDOS2_2.AS:
ACTIVE: DEFB    4               ;currently active drive.
...
;        LD      (ACTIVE),A		;отключено
		nop
		nop
		nop
файл BIOS.AS:
fboot:   ld a,4 ;диск по умолчанию

Логический сектор в CP/M имеет размер 128. Драйвер читает секторами по 256, как наследие TRDOS.
Драйвер HDD читает секторами по 512.
Размер раздела максимум 256 дорожек * 256 секторов * 128 = 8 Мб.
Размер файла максимум 256 секторов * 128 = 32768 байт (надо уточнить).
Количество файлов в каталоге ограничено, для каждого диска по-своему.

-----------------------------------------------
Советы по CP/M для начинающих.

Нужные утилиты можно найти на диске "cp_m_01.trd" от фирмы Scorpion (вставлять в диск A:).
Игры на диске "cp_m_16.trd".

Образы дисков MOA и ATM имеют стандартное расширение .trd и стандартный размер сектора 256. 
Их можно копировать/переносить обычными средствами. 
А логическая структура другая. По одному файлу образы можно редактировать в программе SteinBlume на PC, или средствами CP/M.

На реальном компьютере:
1. Скопировать образ диска MOA/ATM на ZX (с помощью AY232K первые два пункта объединяются).
2. Записать его на дискету (WDC, Fatall).
3. Запустить CP/M.
4. Редактировать/копировать на HDD.
5. Снять образ с дискеты (если требуется).

На эмуляторе:
1. Смонтировать образ диска MOA/ATM.
2. Запустить CP/M.
3. Редактировать/копировать на HDD.
4. Редактировать/копировать образ в SteinBlume (если требуется).

После создания чистого раздела на ЖД нужно с помощью утилиты power удалить последний файл, тогда диск будет пустым и разметится как надо.
Нормальной утилиты для инициализации диска мне не попалось. Format не подходит, он работает напрямую с TRDOS.
Если производится инсталляция системы на HDD, диск будет размечен своей утилитой.

Посмотреть каталог, например:
dir
dir a: 
dir t*.* - все файлы на букву t

Выбрать диск:
c:

Запустить игру:
ladder
e:ladder - то же с конкретного диска

Утилита power.com -
	era - удаление файлов (выведет список и запросит какой удалить)
	stat - инфо о диске
	disk - инфо о диске
	copy - скопировать файл(ы) (через тире можно указать диапазон)
	exit - выход

Утилита pip.com
	pip e:=a:\*.* - скопировать все файлы с A на C (порядок обратный, не как в MSDOS)
	c:pip e:=a:\*.* - то же, с указанием с какого диска запускать утилиту



-----------------------------------------------
Вопросы без ответов.

Какой файловый менеджер использовать?
Как пользоваться com портом, модемом?
Как узнать TPA?
Нужен ли RAM диск, если есть HDD?
Оптимальный размер диска HDD и размера каталогов?
Как вернуть англ раскладку после включения русской?

Диски для ATM:
http://atmturbo.nedopc.com/index.htm
Диски для Profi:
https://poswt.fmshop.ru/index.php?name=Files&op=cat&id=21